<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>StudyCards â€” PreparaciÃ³n</title>

<!-- Favicon -->
<link rel="icon" type="image/jpeg" href="https://raw.githubusercontent.com/fffreire/logoJC/refs/heads/main/jocards.jpg">

<style>
  :root {
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#00c2a8;
    --muted:#94a3b8;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --white: #e6eef6;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  html,body {
    height:100%;
    margin:0;
    background:linear-gradient(180deg,#071028 0%, var(--bg) 100%);
    color:var(--white);
  }

  .wrap {
    max-width:980px;
    margin:36px auto;
    padding:28px;
  }

  header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
  }

  h1 {
    margin:0;
    font-size:26px;
    letter-spacing:0.2px;
  }

  p.lead, h3.lead {
    margin:6px 0 0;
    color:var(--muted);
  }

  .grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
    gap:14px;
    margin-top:22px;
    visibility:hidden;
  }

  .logo {
    height:60px;
    width:auto;
    object-fit:contain;
  }

  @media (min-width:768px) {
    .logo { height:90px; }
  }

  .cat {
    background:linear-gradient(180deg,var(--glass),var(--glass-2));
    border-radius:12px;
    padding:18px;
    cursor:pointer;
    border:1px solid rgba(255,255,255,0.03);
    transition:transform .16s ease, box-shadow .16s ease;
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .cat:hover {
    transform:translateY(-6px);
    box-shadow:0 10px 30px rgba(2,6,23,.6);
  }

  .cat .title { font-weight:600; }
  .cat .meta { font-size:13px; color:var(--muted); }

  footer {
    margin-top:28px;
    color:var(--muted);
    font-size:13px;
    text-align:center;
  }

  /* Modal */
  #modalBg {
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(8px);
    z-index:50;
  }

  .modal {
    background:var(--card);
    border-radius:16px;
    padding:24px;
    max-width:600px;
    width:90%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:16px;
    text-align:center;
    box-shadow:0 10px 40px rgba(0,0,0,0.4);
  }

  .flashcard {
    position:relative;
    width:100%;
    height:220px;
    perspective:1000px;
    cursor:pointer;
  }

  .flashcard-inner {
    position:absolute;
    width:100%;
    height:100%;
    transition:transform 0.6s;
    transform-style:preserve-3d;
  }

  .flashcard.flipped .flashcard-inner {
    transform:rotateY(180deg);
  }

  .flashcard-face {
    position:absolute;
    width:100%;
    height:100%;
    backface-visibility:hidden;
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.08);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    font-size:16px;
  }

  .flashcard-back {
    transform:rotateY(180deg);
  }

  .controls {
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    justify-content:center;
  }

  button {
    background:var(--accent);
    border:none;
    color:#fff;
    padding:8px 14px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
    transition:background .2s ease;
  }

  button:hover {
    background:#01a28e;
  }

  #progressBarContainer {
    background:rgba(255,255,255,0.08);
    width:100%;
    height:6px;
    border-radius:6px;
  }

  #progressBar {
    height:6px;
    border-radius:6px;
    background:var(--accent);
    width:0%;
  }
</style>
</head>

<body>
<div class="wrap">

<header>
  <div style="display:flex;align-items:center;gap:12px">
    <img src="https://raw.githubusercontent.com/fffreire/logoJC/refs/heads/main/jocards.jpg"
         alt="Logo de StudyCards"
         class="logo">
    <div>
      <h1>StudyCards</h1>
      <h3 class="lead">PreparaciÃ³n de Estudios</h3>
    </div>
  </div>

  <div style="display:flex;gap:8px;align-items:center">
    <a href="index.html"><button class="btn">PT</button></a>
    <a href="en.html"><button class="btn">EN</button></a>
    <a href="es.html"><button class="btn">ES</button></a>
  </div>
</header>

<div class="grid" id="categories"></div>

<footer>Hecho con cariÃ±o por Fer, Haru y AnaBia</footer>

</div>

<!-- Modal for Flashcards -->
<div id="modalBg">
  <div class="modal">
    <h2 id="modalTitle"></h2>
    <div class="flashcard" id="flashcard">
      <div class="flashcard-inner">
        <div class="flashcard-face front" id="questionText"></div>
        <div class="flashcard-face flashcard-back" id="answerText"></div>
      </div>
    </div>
    <div id="hintText"></div>
    <div class="controls">
      <button id="prevBtn">â—€ Anterior</button>
      <button id="flipBtn">Mostrar respuesta</button>
      <button id="nextBtn">Siguiente â–¶</button>
      <button id="shuffleBtn">ðŸ”€ Mezclar</button>
      <button id="closeBtn">Cerrar</button>
    </div>
    <div id="progressBarContainer"><div id="progressBar"></div></div>
    <div id="cardIndex">0 / 0</div>
  </div>
</div>

<script>
const SHEET_CSV_URL =
  'https://docs.google.com/spreadsheets/d/e/2PACX-1vR1d3ZJO_bxOCtZ84xD6iYCf_UwjQk-wu3eTotYckh1dLL7LLy9hpHusr7BP-zXM2YuRWHHIUgC0pJf/pub?gid=1233264400&single=true&output=csv';

let localDecks = {};
let activeDeck = [];
let activeIndex = 0;
let flipped = false;

/* elements */
const categoriesEl = document.getElementById('categories');
const modalBg = document.getElementById('modalBg');
const modalTitle = document.getElementById('modalTitle');
const questionText = document.getElementById('questionText');
const answerText = document.getElementById('answerText');
const hintText = document.getElementById('hintText');
const flashcard = document.getElementById('flashcard');
const cardIndex = document.getElementById('cardIndex');
const progressBar = document.getElementById('progressBar');

/* ----- UI builders ----- */
function makeCategoryCard(name, count){
  const div = document.createElement('div');
  div.className = 'cat';
  div.innerHTML = `<div class="title">${name}</div><div class="meta">${count} tarjetas</div>`;
  div.addEventListener('click', () => openDeck(name));
  return div;
}

function renderCategories(){
  categoriesEl.innerHTML = '';
  Object.keys(localDecks).forEach(k=>{
    const count = localDecks[k].length;
    categoriesEl.appendChild(makeCategoryCard(k, count));
  });
}

/* ----- modal logic ----- */
function openDeck(category){
  activeDeck = localDecks[category] ? [...localDecks[category]] : [];
  activeIndex = 0;
  flipped = false;
  modalTitle.textContent = category;
  showModal(true);
  renderCard();
}

function showModal(show){
  modalBg.style.display = show ? 'flex' : 'none';
  modalBg.setAttribute('aria-hidden', show ? 'false' : 'true');
}

function renderCard(){
  if(activeDeck.length === 0){
    questionText.textContent = 'No hay tarjetas en esta categorÃ­a';
    answerText.textContent = '';
    hintText.textContent = '';
    cardIndex.textContent = '0 / 0';
    progressBar.style.width = '0%';
    return;
  }
  const item = activeDeck[activeIndex];
  questionText.textContent = item.q;
  answerText.textContent = item.a;
  hintText.textContent = '';
  flashcard.classList.remove('flipped');
  flipped = false;
  cardIndex.textContent = `${activeIndex+1} / ${activeDeck.length}`;
  const pct = Math.round(((activeIndex+1)/activeDeck.length)*100);
  progressBar.style.width = pct + '%';
}

/* ----- navigation and flip ----- */
document.getElementById('closeBtn').addEventListener('click', ()=> showModal(false));
document.getElementById('nextBtn').addEventListener('click', ()=> {
  if(activeDeck.length===0) return;
  activeIndex = (activeIndex + 1) % activeDeck.length;
  renderCard();
});
document.getElementById('prevBtn').addEventListener('click', ()=> {
  if(activeDeck.length===0) return;
  activeIndex = (activeIndex - 1 + activeDeck.length) % activeDeck.length;
  renderCard();
});

document.getElementById('flipBtn').addEventListener('click', ()=> {
  flipped = !flipped;
  flashcard.classList.toggle('flipped', flipped);
  document.getElementById('flipBtn').textContent = flipped ? 'Ocultar respuesta' : 'Mostrar respuesta';
});

flashcard.addEventListener('click', ()=> {
  flipped = !flipped;
  flashcard.classList.toggle('flipped', flipped);
  document.getElementById('flipBtn').textContent = flipped ? 'Ocultar respuesta' : 'Mostrar respuesta';
});

document.getElementById('shuffleBtn').addEventListener('click', ()=> {
  activeDeck = shuffleArray(activeDeck);
  activeIndex = 0;
  renderCard();
});

function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* ----- CSV loading ----- */
async function loadFromSheet(){
  try{
    const res = await fetch(SHEET_CSV_URL);
    if(!res.ok) throw new Error('fetch failed');
    const text = await res.text();

    const lines = text.split(/\r?\n/).filter(l=>l.trim().length>0);
    const header = lines.shift().split(',').map(h=>h.trim());
    const cIdx = header.findIndex(h=>/category/i.test(h));
    const qIdx = header.findIndex(h=>/question/i.test(h));
    const aIdx = header.findIndex(h=>/answer/i.test(h));
    if(cIdx<0 || qIdx<0 || aIdx<0) throw new Error('CSV headers must include Category, Question, Answer');

    const parsed = {};
    for(const line of lines){
      const values = parseCSVLine(line);
      const cat = values[cIdx] || 'Sin categorÃ­a';
      const q = values[qIdx] || '';
      const a = values[aIdx] || '';
      if(!parsed[cat]) parsed[cat]=[];
      parsed[cat].push({q:q.trim(), a:a.trim()});
    }

    localDecks = parsed;
    renderCategories();
    categoriesEl.style.visibility = 'visible';
  }catch(err){
    console.warn('Error al cargar la hoja:', err);
  }
}

function parseCSVLine(line){
  const out = [];
  let cur = '', inQuotes=false;
  for(let i=0;i<line.length;i++){
    const ch = line[i];
    if(ch === '"' ){
      if(inQuotes && line[i+1]==='"'){ cur += '"'; i++; continue; }
      inQuotes = !inQuotes;
      continue;
    }
    if(ch===',' && !inQuotes){
      out.push(cur);
      cur = '';
      continue;
    }
    cur += ch;
  }
  out.push(cur);
  return out;
}

/* ----- cerrar modal al hacer clic fuera ----- */
modalBg.addEventListener('click', e => {
  if(e.target === modalBg) showModal(false);
});

/* start */
loadFromSheet();
</script>
</body>
</html>
